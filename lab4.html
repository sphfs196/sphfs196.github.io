<!doctype html>
<html lang="en">

<head>
    <meta content="text/html;charset=UTF-8" http-equiv="Content-Type" />
    <script src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js' type='text/javascript'></script>
    <script src="data.js"></script>
</head>
<script>
</script>

<body>
    <div>
        <h1>Main Content:</h1>
        <h5 id="countdown"></h5>
        <h5 id='content_id'></h5>
        <h4 id="main_content"></h4>
    </div>
    <div>
        <form id="mturk_form" method="post" name="mturk_form" onsubmit="handleSubmit(event)">
            <label for="valence">Valence:</label>

            <select id="valence">
              <option value="5" selected> 5 Pleasant</option>
              <option value="4"> 4 Pleased</option>
              <option value="3"> 3 Neutral</option>
              <option value="2"> 2 Unsatisfied</option>
              <option value="1"> 1 Unpleasant</option>
            </select>
            <label for="arousal">Arousal:</label>

            <select id="arousal">
              <option value="5" selected> 5 Excited</option>
              <option value="4"> 4 Wide-awake</option>
              <option value="3"> 3 Neutral</option>
              <option value="2"> 2 Dull</option>
              <option value="1"> 1 Calm</option>
            </select>
            <label for="dominance">Dominance:</label>

            <select id="dominance">
              <option value="5" selected> 5 Dependent</option>
              <option value="4"> 4 Powerlessness</option>
              <option value="3"> 3 Neutral</option>
              <option value="2"> 2 Powerful</option>
              <option value="1"> 1 Independent</option>
            </select>
            <input type="submit" id="submit" disabled>
            <!-- <button type="submit" id="submit">Submit</button> -->

        </form>
    </div>


    <script language='Javascript'>
        //console.log(data[0])
        let index = new Number()
        localStorage.setItem('data', JSON.stringify(data))
        let localdata = JSON.parse(localStorage.getItem('data'))
        let countdown = document.getElementById('countdown')

        function onLoad() {
            let rand = Math.floor(Math.random() * data.length)
            let content = document.getElementById("main_content")
            let content_id = document.getElementById("content_id")
                //if already have comments: rand again.
            if (localdata[rand].comments) onLoad()
            else {
                content.innerHTML = localdata[rand].text
                content_id.innerHTML = "id:" + localdata[rand].idx
                index = rand

                let strLength = Math.floor(localdata[index].text.length / 10)
                countdown.innerHTML = strLength
            }
        }
        onLoad()
        let interval = setInterval(function() {

            if (countdown.innerHTML <= 0) {
                document.getElementById('submit').disabled = false
                countdown.innerHTML = 0
            } else {
                document.getElementById('submit').disabled = true
                countdown.innerHTML -= 1
            }

        }, 1000);

        function timeVerify() {
            if (countdown.innerHTML === '0') {
                //clearInterval(interval)
                //console.log(countdown.innerHTML)
                return true
            } else {
                return false
            }

        }

        //handleSubmit:
        function handleSubmit(event) {
            event.preventDefault()
                //console.log(event)
                //Verify the time.
            if (timeVerify()) {
                turkSetAssignmentID('myform', 'submit')
                    //let valence = document.getElementById('valence').value
                    //let arousal = document.getElementById('arousal').value
                    //let dominance = document.getElementById('dominance').value
                    //const resultJSON = {
                    ////userid: default as 0
                    //userid: 0,
                    //valence: valence,
                    //arousal: arousal,
                    //dominance: dominance
                    //}

                //console.log(JSON.stringify(resultJSON))
                //data[index].comments = resultJSON
                ////after edited: write into localstorage
                //localStorage.setItem('data', JSON.stringify(data))
                //console.log(index)
                //console.log(JSON.stringify(data[index]))
            } else {
                alert("NOT YET!")
            }

        }
    </script>
</body>

</html>
